# ----------------------------
# Development 用 (ホットリロード対応)
# ----------------------------
FROM node:22-alpine

WORKDIR /app
ENV NODE_ENV=development
ENV TZ=Asia/Tokyo

RUN corepack enable && corepack prepare pnpm@latest --activate

# ホットリロード用のファイル変更検知を確実にする
ENV CHOKIDAR_USEPOLLING=true
ENV WATCHPACK_POLLING=true

# 依存インストール
COPY package.json pnpm-lock.yaml* ./
RUN pnpm install

# Prisma client 生成も dev 時にやれるように
COPY prisma ./prisma
RUN npx prisma generate

# （ソースはボリュームでマウントする予定なのでここではコピーしない）

EXPOSE 4000

CMD ["pnpm", "run", "start:dev"]