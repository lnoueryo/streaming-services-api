
# 開発: Node 22 (Alpine)
FROM node:22-alpine

# 推奨: タイムゾーン/ロケールなど（任意）
ENV TZ=Asia/Tokyo
WORKDIR /app

# pnpm 使用（npm 派はこの2行を削除）
RUN corepack enable && corepack prepare pnpm@latest --activate

# 依存だけ先に入れてキャッシュを効かせる（lockfile はプロジェクト直下）
COPY ../package.json ../pnpm-lock.yaml* ./ 
# npm の場合:
# COPY ../package.json ./ 

# 依存インストール
RUN pnpm install
# npm の場合:
# RUN npm ci

# ホットリロードで見るのでソースはバインドでOK
# ただし Nest CLI が必要な場合は devDeps に入れておくこと
EXPOSE 3000

# Windows でも CTRL+C が効くように
STOPSIGNAL SIGINT

# Nest の watch 起動
CMD ["pnpm", "run", "start:dev"]
# npm の場合:
# CMD ["npm", "run", "start:dev"]